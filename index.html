<!DOCTYPE html>
<html lang="en">
  <head>

    <link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css" rel="stylesheet">

  </head>

  <body>
    <div class="container-fluid">

      <h2>CSV to HTML Table</h2>

      <div id='table-container'></div>

    </div><!-- /.container -->

    <footer class='footer'>
      <div class='container-fluid'>
        <hr />
      </div>
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>

    <script type="text/javascript">
        var CsvToHtmlTable = CsvToHtmlTable || {};

        CsvToHtmlTable = {
            init: function (options) {
                options = options || {};
                var csv_path = options.csv_path || "";
                var el = options.element || "table-container";
                var allow_download = options.allow_download || false;
                var csv_options = options.csv_options || {};
                var datatables_options = options.datatables_options || {};
                var custom_formatting = options.custom_formatting || [];
                var customTemplates = {};
                $.each(custom_formatting, function (i, v) {
                    var colIdx = v[0];
                    var func = v[1];
                    customTemplates[colIdx] = func;
                });

                var $table = $("<table class='table table-striped table-condensed' id='" + el + "-table'></table>");
                var $containerElement = $("#" + el);
                $containerElement.empty().append($table);

                $.when($.get(csv_path)).then(
                    function (data) {
                        var csvData = $.csv.toArrays(data, csv_options);
                        var $tableHead = $("<thead></thead>");
                        var csvHeaderRow = csvData[0];
                        var $tableHeadRow = $("<tr></tr>");
                        for (var headerIdx = 0; headerIdx < csvHeaderRow.length; headerIdx++) {
                            $tableHeadRow.append($("<th></th>").text(csvHeaderRow[headerIdx]));
                        }
                        $tableHead.append($tableHeadRow);

                        $table.append($tableHead);
                        var $tableBody = $("<tbody></tbody>");

                        for (var rowIdx = 1; rowIdx < csvData.length; rowIdx++) {
                            var $tableBodyRow = $("<tr></tr>");
                            for (var colIdx = 0; colIdx < csvData[rowIdx].length; colIdx++) {
                                var $tableBodyRowTd = $("<td></td>");
                                var cellTemplateFunc = customTemplates[colIdx];
                                if (cellTemplateFunc) {
                                    $tableBodyRowTd.html(cellTemplateFunc(csvData[rowIdx][colIdx]));
                                } else {
                                    $tableBodyRowTd.text(csvData[rowIdx][colIdx]);
                                }
                                $tableBodyRow.append($tableBodyRowTd);
                                $tableBody.append($tableBodyRow);
                            }
                        }
                        $table.append($tableBody);

                        $table.DataTable(datatables_options);

                        if (allow_download) {
                            $containerElement.append("<p><a class='btn btn-info' href='" + csv_path + "'><i class='glyphicon glyphicon-download'></i> Download as CSV</a></p>");
                        }
                    });
            }
        };
    </script>

    <script type="text/javascript">
      function format_link(link){
        if (link)
          return "<a href='" + link + "' target='_blank'>" + link + "</a>";
        else
          return "";
      }

      CsvToHtmlTable.init({
        csv_path: 'data/data.csv',
        element: 'table-container',
        allow_download: false,
        csv_options: {separator: ',', delimiter: '"'},
        datatables_options: {"paging": false},
        custom_formatting: [[4, format_link]]
      });
    </script>
  </body>
</html>
